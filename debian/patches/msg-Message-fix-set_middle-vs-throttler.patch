From: Sage Weil <sage@redhat.com>
Date: Sun, 23 Oct 2016 18:10:00 -0500
Subject: msg/Message: fix set_middle vs throttler

Signed-off-by: Sage Weil <sage@redhat.com>
(cherry picked from commit e7bf50b27a495ed75def67025d1ceca83861ba35)
---
 src/msg/Message.h | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/msg/Message.h b/src/msg/Message.h
index 25b0372..5ff6c2f 100644
--- a/src/msg/Message.h
+++ b/src/msg/Message.h
@@ -366,10 +366,10 @@ public:
 
   void set_middle(bufferlist& bl) {
     if (byte_throttler)
-      byte_throttler->put(payload.length());
+      byte_throttler->put(middle.length());
     middle.claim(bl, buffer::list::CLAIM_ALLOW_NONSHAREABLE);
     if (byte_throttler)
-      byte_throttler->take(payload.length());
+      byte_throttler->take(middle.length());
   }
   bufferlist& get_middle() { return middle; }
 
